meta:
- desc: run the rbd_mirror_journal.sh workunit to test the rbd-mirror daemon
tasks:
- ceph:
    cluster: cluster3
- rbd-mirror:
    client: cluster3.client.mirror.0
    thrash: True
- rbd-mirror:
    client: cluster3.client.mirror.1
    thrash: True
- rbd-mirror:
    client: cluster3.client.mirror.2
    thrash: True
- rbd-mirror:
    client: cluster3.client.mirror.3
    thrash: True
- rbd-mirror-thrash:
    cluster: cluster3
- workunit:
    clients:
      cluster1.client.mirror: [rbd/rbd_mirror_journal.sh]
    env:
      # override workunit setting of CEPH_ARGS='--cluster'
      CEPH_ARGS: ''
      RBD_MIRROR_INSTANCES: '4'
      RBD_MIRROR_USE_EXISTING_CLUSTER: '1'
      RBD_MIRROR_USE_RBD_MIRROR: '1'
      USE_CLUSTER3: '1'
